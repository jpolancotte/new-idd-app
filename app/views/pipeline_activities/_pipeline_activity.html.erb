<div id="<%= dom_id pipeline_activity %>">

  <% obip = pipeline_activity.deals.where(deal_stage_id: DealStage.find_by_name("Onboarding - In Progress").id) %>
  <% inactive = pipeline_activity.deals.where(deal_stage_id: DealStage.find_by_name("Sales - Inactive").id) %>
  <% cn = pipeline_activity.deals.where(deal_stage_id: DealStage.find_by_name("Sales - Contract Negotiation").id) %>
  <% nd = pipeline_activity.deals.where(created_at: pipeline_activity.start_date..pipeline_activity.end_date) %>

  <div class="container-fluid">
    <table class="table table-striped table-hover table-sm">
      <thead>
        <tr>
          <th>Pipeline date</th>  
          <th>Onboarding - In Progress</th>   
          <th>Contract Negotiation</th>        
          <th>New deals</th> 
          <th>Deals updated</th>    
          <th>Onboarding - Complete	</th>  
          <th>Inactive</th>  
          <th>Activities</th>       
        </tr>
      </thead>
      <tbody>
        <tr>
          <td> <%= link_to pipeline_activity.end_date.strftime('%m-%d-%Y'), pipeline_activity %> </td>
          <td> deals <%= obip.size %> | <%= obip.sum(&:total_residential_individuals) %> beds </td>  
          <td> deals <%= cn.size %> | <%= cn.sum(&:total_residential_individuals) %> beds </td>                
          <td> deals <%= nd.size %> | <%= nd.sum(&:total_residential_individuals) %> beds </td>   
          <td> <%= pipeline_activity.deals.size %> </td>   
          <td> <%= pipeline_activity.deals.where(deal_stage_id: DealStage.find_by_name("Onboarding - Complete").id).size %> </td>
          <td> deals <%= inactive.size %> | <%= inactive.sum(&:total_residential_individuals) %> beds </td>  
          <td> <%= pipeline_activity.events.size %> </td>  
        </tr>
      </tbody>
    </table>
    
  </div>

</div>

